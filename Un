-- Services and Player Setup
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer

-- Remotes
local skillEvent = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("SkillEvent")
local spinEvent = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("SpinEvent")

-- Farming Variables
local farming = true
local spinning = true

-- Desirable Essences
local desiredEssences = {
    ["Cosmic Essence"] = true,
    ["Spatial Essence"] = true,
    ["Essence of Destruction"] = true,
    ["Arcane Essence"] = true
}

-- Helper Function to Fire SkillEvent
local function fireSkill(skill, timestamp, extra)
    local character = LocalPlayer.Character
    if character and character:FindFirstChild("HumanoidRootPart") then
        local rootPart = character.HumanoidRootPart
        local position = rootPart.Position
        local rotation = rootPart.CFrame
        local args = {skill, position, rotation, timestamp, extra}
        skillEvent:FireServer(unpack(args))
    else
        warn("Character or HumanoidRootPart not found!")
    end
end

-- Farming Logic
local function autoFarm()
    while farming do
        task.wait(0.5) -- Prevents excessive load on the game
        
        -- Fire skill events dynamically based on current position
        fireSkill("E", os.time(), "e1")
        fireSkill("R", os.time(), "e1")
        fireSkill("F", os.time(), "e1")
        fireSkill("E", os.time(), "e2")
        fireSkill("R", os.time(), "e2")
        fireSkill("F", os.time(), "e2")
        
        -- Check Level
        local level = LocalPlayer:FindFirstChild("Level")
        if level and level.Value >= 10 then
            spinning = true
            break
        end
    end
end

-- Spinner Logic
local function autoSpin()
    while spinning do
        task.wait(0.5) -- Prevents excessive load on the game
        
        -- Fire spin remote
        spinEvent:FireServer("e1")
        
        -- Check Spin Result
        local essences = LocalPlayer:FindFirstChild("Essences")
        if essences then
            for _, essence in pairs(essences:GetChildren()) do
                if desiredEssences[essence.Name] then
                    print("Desired essence obtained:", essence.Name)
                    spinning = false
                    break
                end
            end
        end
        
        -- Break the loop if spinning stops
        if not spinning then
            break
        end
    end
end

-- Main Loop
task.spawn(function()
    while true do
        if farming then
            autoFarm()
        end
        
        if spinning then
            autoSpin()
        end
        
        -- Reset farming after spin
        if not spinning then
            farming = true
        end
    end
end)
