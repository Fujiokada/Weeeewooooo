-- Autofarm and Auto Spinner Script
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer
local SpinEvent = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("SpinEvent")
local SkillEvent = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("SkillEvent")

-- Configurable Variables
local toggleKey = Enum.KeyCode.P
local levelThreshold = 10
local desiredEssences = {"Cosmic Essence", "Spatial Essence", "Essence of Destruction", "Arcane Essence"}
local autofarmEnabled = false
local spinnerEnabled = true

-- Function to check for desired essences
local function hasDesiredEssence()
    for _, essenceName in ipairs(desiredEssences) do
        if LocalPlayer:FindFirstChild("Essences") and LocalPlayer.Essences:FindFirstChild("Essence1") and
            LocalPlayer.Essences.Essence1.Value == essenceName then
            return true
        end
    end
    return false
end

-- Function to fire skill events dynamically
local function fireSkill(skill, essenceType)
    local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local position = character.HumanoidRootPart.Position
    local rotation = character.HumanoidRootPart.CFrame

    local args = {
        skill,
        position,
        rotation,
        os.clock(),
        essenceType
    }
    SkillEvent:FireServer(unpack(args))
end

-- Function to perform the autofarm loop
local function autofarmLoop()
    while autofarmEnabled do
        -- Check Level
        if LocalPlayer:FindFirstChild("Level") and LocalPlayer.Level.Value >= levelThreshold then
            if spinnerEnabled then
                -- Spin for Essence
                SpinEvent:FireServer("e1")
                wait(1) -- Wait for spin result

                -- Check for desired essence
                if hasDesiredEssence() then
                    spinnerEnabled = false -- Stop spinner
                end
            end
        else
            -- Fire "e1" skills
            fireSkill("E", "e1")
            wait(0.5)
            fireSkill("R", "e1")
            wait(0.5)
            fireSkill("F", "e1")
            wait(1)

            -- Fire "e2" skills
            fireSkill("E", "e2")
            wait(0.5)
            fireSkill("R", "e2")
            wait(0.5)
            fireSkill("F", "e2")
            wait(1) -- Adjust delay as needed
        end
    end
end

-- Toggle Autofarm on/off
game:GetService("UserInputService").InputBegan:Connect(function(input, processed)
    if processed then return end
    if input.KeyCode == toggleKey then
        autofarmEnabled = not autofarmEnabled
        if autofarmEnabled then
            print("Autofarm Enabled")
            spinnerEnabled = true
            spawn(autofarmLoop)
        else
            print("Autofarm Disabled")
        end
    end
end)

print("Autofarm script loaded. Press 'P' to toggle on/off.")
